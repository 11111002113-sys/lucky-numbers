<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Settings - Lucky Numbers</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/admin.css">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container">
      <div class="header-content">
        <h1>‚öôÔ∏è Admin Settings</h1>
        <p>Manage your account settings and security</p>
        <nav class="nav">
          <a href="/admin/dashboard.html" class="nav-link">Dashboard</a>
          <a href="/admin/settings.html" class="nav-link active">Settings</a>
          <a href="/" class="nav-link" target="_blank">View Website</a>
          <a href="#" class="nav-link" onclick="logout()">Logout</a>
        </nav>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container">
    <!-- Success/Error Messages -->
    <div id="successMessage" class="alert alert-success" style="display: none;"></div>
    <div id="errorMessage" class="alert alert-error" style="display: none;"></div>

    <!-- Account Information -->
    <div class="card" style="padding: 20px; margin-bottom: 20px;">
      <h3 style="color: var(--primary-color); margin-bottom: 15px;">üë§ Account Information</h3>
      <div style="padding: 15px; background: var(--background); border-radius: 8px;">
        <p style="margin: 5px 0;"><strong>Email:</strong> <span id="currentEmail">Loading...</span></p>
        <p style="margin: 5px 0;"><strong>Role:</strong> <span id="currentRole">Admin</span></p>
        <p style="margin: 5px 0;"><strong>2FA Status:</strong> <span id="twoFactorStatus">Loading...</span></p>
      </div>
    </div>

    <!-- Change Email -->
    <div class="card" style="padding: 20px; margin-bottom: 20px;">
      <h3 style="color: var(--primary-color); margin-bottom: 15px;">üìß Change Email</h3>
      <form id="emailForm" onsubmit="changeEmail(event)">
        <div class="form-group">
          <label for="newEmail">New Email Address</label>
          <input type="email" id="newEmail" name="newEmail" required placeholder="Enter new email">
        </div>
        <div class="form-group">
          <label for="currentPasswordEmail">Current Password (for verification)</label>
          <input type="password" id="currentPasswordEmail" name="currentPasswordEmail" required placeholder="Enter current password" minlength="6">
        </div>
        <button type="submit" class="btn btn-primary" id="emailBtn">
          <span id="emailBtnText">Update Email</span>
          <span id="emailBtnSpinner" class="btn-spinner" style="display: none;"></span>
        </button>
      </form>
    </div>

    <!-- Change Password -->
    <div class="card" style="padding: 20px; margin-bottom: 20px;">
      <h3 style="color: var(--primary-color); margin-bottom: 15px;">üîí Change Password</h3>
      <form id="passwordForm" onsubmit="changePassword(event)">
        <div class="form-group">
          <label for="currentPassword">Current Password</label>
          <input type="password" id="currentPassword" name="currentPassword" required placeholder="Enter current password" minlength="6">
        </div>
        <div class="form-group">
          <label for="newPassword">New Password</label>
          <input type="password" id="newPassword" name="newPassword" required placeholder="Enter new password" minlength="6">
          <small style="color: var(--text-secondary); font-size: 0.85rem;">Minimum 6 characters</small>
        </div>
        <div class="form-group">
          <label for="confirmPassword">Confirm New Password</label>
          <input type="password" id="confirmPassword" name="confirmPassword" required placeholder="Confirm new password" minlength="6">
        </div>
        <button type="submit" class="btn btn-primary" id="passwordBtn">
          <span id="passwordBtnText">Update Password</span>
          <span id="passwordBtnSpinner" class="btn-spinner" style="display: none;"></span>
        </button>
      </form>
    </div>

    <!-- 2FA Settings -->
    <div class="card" style="padding: 20px; margin-bottom: 20px;">
      <h3 style="color: var(--primary-color); margin-bottom: 15px;">üîê Two-Factor Authentication (2FA)</h3>
      
      <div id="2faDisabled" style="display: none;">
        <p style="margin-bottom: 15px; color: var(--text-secondary);">Enable 2FA for enhanced security. You'll need an authenticator app like Google Authenticator or Authy.</p>
        <button onclick="setup2FA()" class="btn btn-success" id="setup2FABtn">
          <span id="setup2FAText">Setup 2FA</span>
          <span id="setup2FASpinner" class="btn-spinner" style="display: none;"></span>
        </button>
      </div>

      <div id="2faEnabled" style="display: none;">
        <div style="padding: 15px; background: #dcfce7; border-radius: 8px; margin-bottom: 15px; border: 1px solid #86efac;">
          <p style="margin: 0; color: #16a34a; font-weight: 600;">‚úì 2FA is currently enabled</p>
        </div>
        <button onclick="disable2FA()" class="btn btn-danger" id="disable2FABtn">
          <span id="disable2FAText">Disable 2FA</span>
          <span id="disable2FASpinner" class="btn-spinner" style="display: none;"></span>
        </button>
      </div>

      <!-- 2FA Setup Modal -->
      <div id="2faSetupModal" style="display: none; padding: 20px; background: var(--background); border-radius: 8px; margin-top: 20px; border: 2px solid var(--primary-color);">
        <h4 style="margin-bottom: 15px;">Scan QR Code</h4>
        <div style="text-align: center; margin-bottom: 15px;">
          <img id="qrCodeImage" src="" alt="QR Code" style="max-width: 250px; border: 1px solid var(--border-color); padding: 10px; background: white;">
        </div>
        <p style="margin-bottom: 10px; font-size: 0.9rem;">Or enter this code manually:</p>
        <div style="padding: 10px; background: white; border: 1px solid var(--border-color); border-radius: 6px; font-family: monospace; font-size: 0.9rem; margin-bottom: 15px; word-break: break-all;">
          <span id="manualSecret"></span>
        </div>
        <form onsubmit="verify2FA(event)">
          <div class="form-group">
            <label for="verifyToken">Enter 6-digit code from your app</label>
            <input type="text" id="verifyToken" name="verifyToken" required pattern="[0-9]{6}" maxlength="6" placeholder="000000" style="font-size: 1.2rem; letter-spacing: 0.5rem; text-align: center;">
          </div>
          <button type="submit" class="btn btn-primary btn-block" id="verify2FABtn">
            <span id="verify2FAText">Verify & Enable 2FA</span>
            <span id="verify2FASpinner" class="btn-spinner" style="display: none;"></span>
          </button>
          <button type="button" onclick="cancel2FASetup()" class="btn btn-secondary btn-block" style="margin-top: 10px; background: #6b7280;">Cancel</button>
        </form>
      </div>
    </div>

    <!-- Security Questions -->
    <div class="card" style="padding: 20px; margin-bottom: 20px;">
      <h3 style="color: var(--primary-color); margin-bottom: 15px;">‚ùì Security Questions</h3>
      <p style="margin-bottom: 15px; color: var(--text-secondary);">Set up security questions to reset your password without email. Answer 3 questions that only you know.</p>
      <a href="/admin/security-questions.html" class="btn btn-primary">
        Setup Security Questions
      </a>
    </div>

  </main>

  <!-- Footer -->
  <footer class="footer">
    <p>&copy; 2025 Lucky Numbers. All rights reserved.</p>
  </footer>

  <script src="/js/admin-settings.js"></script>
</body>
</html>
